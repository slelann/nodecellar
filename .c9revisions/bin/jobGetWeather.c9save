{"ts":1377699541186,"silentsave":true,"restoring":false,"patch":[[{"diffs":[[1,"#! /app/bin/node\nvar Forecast = require('forecast.io');\n\nvar TempoDBClient = require('tempodb').TempoDBClient;\nvar tempodb = new TempoDBClient('18b5f055f1af4bb69e60698ac5812ccf', '9e8380a60d384761a98b722eec55091d');\n\n\n/**\n * get Forecast.io current weather data\n */\nfunction getWeather() {\n\t\n\t//  APIKey: process.env.FORECAST_API_KEY\n\tvar key = {\n\t\tAPIKey:  \"756a4a008fed90be13cd417dd4a3f60e\",\n\t\texclude: \"minutely,hourly,daily,flags,alerts\",\n\t\tunits:   \"si\"\n\t};\n\tvar forecast = new Forecast(key);\n\t\n\t// Coordonnees de Chevaigne\n\tvar latitude  = \"48.2097\";\n\tvar longitude = \"-1.6298\";\n\t\n\tvar options = {\n\t\tunits:   \"si\",\n\t\texclude: \"minutely,hourly,daily,flags,alerts\"\n\t};\n\t\t\n\t//forecast.get(latitude, longitude, options, logData);\n\tforecast.get(latitude, longitude, options, insertWeatherData);\n}\n\n/**\n * Simple function to log current weather data collected\n */\nfunction logData (err, res, data) {\n\tif (err) throw err;\n\telse {\n\t\tvar temp=data.currently.temperature;\n\t\tvar hum=data.currently.humidity * 100;\n\t\tvar date=new Date();\n\t\tconsole.log('date       : '+date);\n\t\tconsole.log('temperature: '+temp);\n\t\tconsole.log('humidite   : '+hum);\n\t};\n}\n\n/**\n * insertWeatherData function to store values in tempodb series\n */\n\nfunction insertWeatherData (err, res, data) {\n\tconsole.log('insertWeatherData');\n\tif (err) throw err;\n\telse {\n\t\tvar tempOutsideKey = 'location:outside.temperature.1';\n\t\tvar humOutsideKey  = 'location:outside.humidity.1';\n\t\tvar date=new Date();\n\t\t\n\t\tvar tempoData = [{key:tempOutsideKey, v: data.currently.temperature},\n\t\t\t\t\t\t {key:humOutsideKey, v: data.currently.humidity * 100}];\n\t\t\t\t\t\t\n\t\tvar cb = function(result){ console.log('Weather data insertion for ' + date + ' : ' + result.response); };\n\n\t\ttempodb.write_bulk(new Date(),tempoData,cb);\n\t}\n}\n\n// MAIN\ngetWeather();\n\n"]],"start1":0,"start2":0,"length1":0,"length2":1797}]],"length":1797}
